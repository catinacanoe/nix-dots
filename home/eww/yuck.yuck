(defwidget dock_block [halign ?class]
    (box :orientation "horizontal" :class "dock-block ${class}"
         :hexpand false :halign halign :spacing 7 :space-evenly false
        (children)
    )
)

(defwidget dock_layout []
    (box :orientation "horizontal" :class "dock-layout" :valign "center"
        (dock_left) (dock_middle) (dock_right)
    )
)

(defvar var_switching false)
(defvar var_active 1)
(defvar var_prev 1)
(defvar var_workspaces '[{"id":"1","windows":0}]')
(defwidget dock_middle []
    (dock_block :halign "center"
        (box :class "dock-widget" :space-evenly false
            (for workspace in var_workspaces
                (box :orientation "vertical" :space-evenly false
                    (box :class "dock-workspace-pad")
                    (box :class "dock-workspaces n${workspace.windows >= 5 ? "5" : workspace.windows} ${var_switching ? (workspace.id == var_active ? "active switching" : ((workspace.windows > 0 ? "occupied" : "empty") + (workspace.id == var_prev ? " switching" : ""))) : (workspace.id == var_active ? "active" : (workspace.windows > 0 ? "occupied" : "empty"))}")
                    (box :class "dock-workspace-pad")
                )
            )
        )
    )
)

(defvar var_mus_color "purple-orange")
(defwidget dock_left []
    (dock_block :halign "start" :class "music ${var_mus_color}"
        (dock_current)
    )
)

(defwidget dock_widget []
    (box :class "dock-widget" :valign "center"
        (children)
    )
)

(defvar var_current "nothing playing")
(defvar var_time "0:00/0:00")
(defwidget dock_current []
    (dock_widget
        (label
            :text "${var_current}"
            :class "dock-current"
        )
    )
)


(defpoll poll_net_vpn :interval "5s" `protonvpn status | grep '^Status: ' | awk '{ print $2 }' | grep -o '^.' | sed -e 's|C|v |' -e 's|D||'`)
(defpoll poll_net_name :interval "2s" `nmcli -t device wifi list --rescan no | grep '^*' | awk -F ':' '{ print $8 }' | tr '[:upper:]' '[:lower:]'`)
(defvar var_net_check "")
(defwidget dock_net []
    (dock_widget
        (label
            :text "${poll_net_vpn}${poll_net_name}${var_net_check}"
            :class "dock-net"
        )
    )
)

(defvar var_audio_device "")
(defvar var_volume "0")
(defwidget dock_volume []
    (dock_widget
        (label
            :text "${var_volume}%${var_audio_device}"
            :class "dock-volume"
        )
    )
)

(defvar var_brightness "100")
(defwidget dock_brightness []
    (dock_widget
        (label
            :text "${var_brightness}%"
            :class "dock-brightness"
        )
    )
)

(defvar var_battery "100%")
(defwidget dock_battery []
    (dock_widget
        (label
            :text var_battery
            :class "dock-battery"
        )
    )
)

(defpoll poll_time :interval "1s" `date +'%d.%m.%Y ~ %H:%M'`)
(defwidget dock_time []
    (dock_widget
        (label
            :text poll_time
            :class "dock-time"
        )
    )
)
